app-id: io.github.wazzaps.Fingerpaint
runtime: org.gnome.Platform
runtime-version: '44'
sdk: org.gnome.Sdk
command: "fingerpaint"
finish-args:
  # GUI Permissions
  - "--share=ipc"
  - "--socket=wayland"
  - "--socket=fallback-x11"
  - "--device=dri"

  # Access to udev for finding raw touchpad device
  - "--device=all"
  - "--filesystem=/sys:ro"
  - "--filesystem=/run/udev:ro"
modules:
  - generated-poetry-sources.json

  # Taken from: https://archlinux.org/packages/extra/x86_64/xorg-xinput/
  - name: xinput
    only-arches: [ x86_64 ]
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - zstd -d < xorg-xinput-1.6.4-1-x86_64.pkg.tar.zst | tar x usr/bin/xinput && mv usr/bin/xinput /app/bin/
    sources:
      - type: file
        url: "https://asia.mirror.pkgbuild.com/extra/os/x86_64/xorg-xinput-1.6.4-1-x86_64.pkg.tar.zst"
        sha256: "db8769c1c584414074bdf18a3a8c952bdaf70dfd724256048b6276eeadb566ea"
  - name: xinput
    only-arches: [aarch64]
    buildsystem: simple
    build-commands:
      - mkdir -p /app/bin
      - xz -d < xorg-xinput-1.6.4-1-aarch64.pkg.tar.xz | tar x usr/bin/xinput && mv usr/bin/xinput /app/bin/
    sources:
      - type: file
        url: "http://mirror.archlinuxarm.org/aarch64/extra/xorg-xinput-1.6.4-1-aarch64.pkg.tar.xz"
        sha256: "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"

  - name: fingerpaint
    buildsystem: simple
    build-commands:
      - python3 setup.py bdist_wheel && pip3 install --no-deps --no-index --prefix=/app dist/*.whl
      - install -D flatpak/$FLATPAK_ID.metainfo.xml $FLATPAK_DEST/share/appdata/$FLATPAK_ID.appdata.xml
      - install -D flatpak/$FLATPAK_ID.desktop $FLATPAK_DEST/share/applications/$FLATPAK_ID.desktop
      - install -D snap/gui/fingerpaint.svg $FLATPAK_DEST/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
    sources:
      - type: dir
        path: ".."
